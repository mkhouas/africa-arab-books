<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>مرصد مراجعات الكتب — أفريقيا والعالم العربي (آخر سنتين فقط)</title>

<style>
body{font-family:Tahoma,Arial;background:#f8f9fa;margin:0}
header{background:#7f1d1d;color:#fff;padding:25px;text-align:center}
header h1{margin:0;font-size:20px}
.container{max-width:1200px;margin:30px auto;padding:0 15px}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(350px,1fr));gap:18px}
.card{background:#fff;border-radius:10px;padding:15px;border-right:4px solid #7f1d1d;box-shadow:0 2px 10px rgba(0,0,0,.05)}
.card h3{margin:0 0 10px;font-size:15px}
.meta{font-size:12px;color:#555;margin-bottom:8px}
.book{background:#fff7ed;padding:8px;border-radius:6px;font-size:13px;margin-bottom:10px}
.badge{display:inline-block;background:#7f1d1d;color:#fff;font-size:11px;padding:3px 8px;border-radius:12px;margin-left:5px}
.loader{text-align:center;padding:50px}
</style>
</head>

<body>

<header>
<h1>مرصد مراجعات الكتب السياسية والاقتصادية — أفريقيا والعالم العربي<br>
(فقط Book Reviews — آخر سنتين)</h1>
</header>

<div class="container">
<div id="grid" class="grid">
<div class="loader">جارٍ التحميل...</div>
</div>
</div>

<script>
// ═══════════════════════════════════════════════
// إعدادات أساسية
// ═══════════════════════════════════════════════
const TWO_YEARS = 2 * 365 * 24 * 60 * 60 * 1000;
let RESULTS = [];

// ═══════════════════════════════════════════════
// فلتر مراجعة كتاب صريحة
// ═══════════════════════════════════════════════
function isBookReview(item){
 const t=(item.title||'').toLowerCase();
 if(item.type==="book-review") return true;
 if(/\bbook review\b/.test(t)) return true;
 if(/\breview of\b/.test(t)) return true;
 if(/مراجعة كتاب|عرض كتاب|قراءة في كتاب/.test(t)) return true;
 if(/compte rendu|recension/.test(t)) return true;
 return false;
}

// ═══════════════════════════════════════════════
// فلتر الموضوع السياسي/الاقتصادي
// ═══════════════════════════════════════════════
const TOPIC=/politic|govern|econom|democra|conflict|security|policy|سياس|اقتصاد|حكم|ديمقراط|صراع|أمن|تنمية|économ|politique|gouvern/i;

// ═══════════════════════════════════════════════
// فلتر جغرافي (أفريقيا + عربي/شرق أوسط)
// ═══════════════════════════════════════════════
const GEO=/africa|sahel|maghreb|nigeria|ethiopia|kenya|ghana|senegal|sudan|somalia|congo|south africa|arab|middle east|egypt|morocco|algeria|tunisia|libya|syria|iraq|lebanon|yemen|jordan|palestine|saudi|gulf|إفريق|الساحل|المغرب|الجزائر|تونس|ليبيا|مصر|السودان|الصومال|العراق|سوريا|لبنان|فلسطين|السعودية|الخليج|الشرق الأوسط|عرب/i;

function isRelevant(item){
 const text=(item.title+" "+(item.abstract||"")).toLowerCase();
 return TOPIC.test(text) && GEO.test(text);
}

// ═══════════════════════════════════════════════
// فلتر زمني صارم (تاريخ نشر المراجعة)
// ═══════════════════════════════════════════════
function withinTwoYears(dateStr){
 if(!dateStr) return false;
 const d=new Date(dateStr);
 if(isNaN(d.getTime())) return false;
 return (Date.now()-d.getTime())<=TWO_YEARS;
}

// ═══════════════════════════════════════════════
// استخراج اسم الكتاب من العنوان
// ═══════════════════════════════════════════════
function extractBook(title){
 let m=title.match(/review of (.+?) by (.+)/i);
 if(m) return {title:m[1],author:m[2]};
 m=title.match(/مراجعة كتاب[:\s]*(.+)/);
 if(m) return {title:m[1],author:''};
 return null;
}

// ═══════════════════════════════════════════════
// جلب من Crossref (Book Review فقط)
// ═══════════════════════════════════════════════
async function fetchCrossref(){
 const from=new Date(Date.now()-TWO_YEARS);
 const fd=`${from.getFullYear()}-${String(from.getMonth()+1).padStart(2,'0')}-01`;

 const url=`https://api.crossref.org/works?rows=100&filter=type:book-review,from-pub-date:${fd}&sort=published&order=desc`;

 const res=await fetch(url);
 const data=await res.json();
 const items=data.message.items||[];

 return items.map(w=>{
  const dateParts=w["published-print"]?.["date-parts"]?.[0]||w["published-online"]?.["date-parts"]?.[0]||[];
  const date=dateParts.length?`${dateParts[0]}-${dateParts[1]||1}-${dateParts[2]||1}`:'';

  return{
   id:w.DOI,
   title:(w.title||[])[0]||'',
   journal:(w["container-title"]||[])[0]||'',
   abstract:(w.abstract||'').replace(/<[^>]*>/g,''),
   date,
   url:w.URL||'',
   type:w.type||''
  }
 });
}

// ═══════════════════════════════════════════════
// المحرك الرئيسي
// ═══════════════════════════════════════════════
async function init(){
 const raw=await fetchCrossref();

 const filtered=raw.filter(item=>{
  if(!withinTwoYears(item.date)) return false;
  if(!isBookReview(item)) return false;
  if(!isRelevant(item)) return false;
  if(!extractBook(item.title)) return false;
  return true;
 });

 RESULTS=filtered;
 render();
}

// ═══════════════════════════════════════════════
// العرض
// ═══════════════════════════════════════════════
function render(){
 const grid=document.getElementById("grid");
 grid.innerHTML="";

 if(!RESULTS.length){
  grid.innerHTML="<div class='loader'>لا توجد مراجعات مطابقة خلال آخر سنتين.</div>";
  return;
 }

 RESULTS.forEach(r=>{
  const book=extractBook(r.title);
  const card=document.createElement("div");
  card.className="card";

  card.innerHTML=`
  <span class="badge">Book Review</span>
  <h3>${r.title}</h3>
  <div class="meta">${r.journal} — ${r.date}</div>
  ${book?`<div class="book"><strong>الكتاب:</strong> ${book.title}<br><strong>المؤلف:</strong> ${book.author||'غير مذكور'}</div>`:''}
  <a href="${r.url}" target="_blank">قراءة المصدر</a>
  `;

  grid.appendChild(card);
 });
}

init();
</script>

</body>
</html>
