<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù…Ø±ØµØ¯ Ø§Ù„ÙƒØªØ¨ ÙˆØ§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø§Øª â€” Ø§Ù„Ø´Ø¤ÙˆÙ† Ø§Ù„Ø£ÙØ±ÙŠÙ‚ÙŠØ© ÙˆØ§Ù„Ø¹Ø±Ø¨ÙŠØ©</title>
<style>
  * { margin:0; padding:0; box-sizing:border-box; }

  :root {
    --bg: #f0f2f5;
    --card: #ffffff;
    --text: #1a1a2e;
    --text2: #555;
    --accent: #0d7377;
    --accent2: #14919b;
    --gold: #d4a017;
    --ar: #059669;
    --fr: #2563eb;
    --en: #7c3aed;
    --review: #f59e0b;
    --shadow: 0 2px 20px rgba(0,0,0,.06);
    --radius: 16px;
  }

  body {
    font-family: 'Segoe UI', Tahoma, Arial, sans-serif;
    background: var(--bg);
    color: var(--text);
    line-height: 1.6;
    min-height: 100vh;
  }

  /* â”€â”€ Ø§Ù„ØªØ±ÙˆÙŠØ³Ø© â”€â”€ */
  .hero {
    background: linear-gradient(135deg, #0d1117 0%, #0d7377 50%, #14919b 100%);
    color: white;
    padding: 40px 20px;
    text-align: center;
    position: relative;
    overflow: hidden;
  }
  .hero::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(255,255,255,.03) 0%, transparent 70%);
    animation: pulse 8s ease-in-out infinite;
  }
  @keyframes pulse {
    0%,100% { transform: scale(1); }
    50% { transform: scale(1.1); }
  }
  .hero h1 { font-size: 2.2em; font-weight: 800; position: relative; }
  .hero p { font-size: 1.1em; opacity: .85; margin-top: 8px; position: relative; }
  .hero .badges { display: flex; gap: 10px; justify-content: center; margin-top: 16px; position: relative; flex-wrap: wrap; }
  .hero .badge {
    padding: 6px 18px;
    border-radius: 30px;
    font-size: .85em;
    font-weight: 600;
    border: 1px solid rgba(255,255,255,.2);
    background: rgba(255,255,255,.1);
    backdrop-filter: blur(4px);
  }

  /* â”€â”€ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª â”€â”€ */
  .tabs {
    max-width: 1400px;
    margin: -30px auto 0;
    padding: 0 20px;
    position: relative;
    z-index: 10;
    display: flex;
    gap: 8px;
    justify-content: center;
  }
  .tab-btn {
    padding: 14px 32px;
    border: none;
    background: rgba(255,255,255,.9);
    color: var(--text2);
    font-size: 1em;
    font-weight: 700;
    border-radius: var(--radius) var(--radius) 0 0;
    cursor: pointer;
    transition: all .3s;
    box-shadow: var(--shadow);
  }
  .tab-btn:hover { background: white; color: var(--accent); }
  .tab-btn.active { background: white; color: var(--accent); border-bottom: 4px solid var(--accent); }

  .tab-content { display: none; }
  .tab-content.active { display: block; }

  /* â”€â”€ Ø´Ø±ÙŠØ· Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª â”€â”€ */
  .stats-bar {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: 12px;
    max-width: 1400px;
    margin: 20px auto;
    padding: 0 20px;
  }
  .stat-card {
    background: var(--card);
    border-radius: var(--radius);
    padding: 20px 16px;
    text-align: center;
    box-shadow: var(--shadow);
    border: 1px solid rgba(0,0,0,.04);
  }
  .stat-card .num { font-size: 1.8em; font-weight: 800; }
  .stat-card .lbl { font-size: .8em; color: var(--text2); margin-top: 2px; }

  /* â”€â”€ Ø§Ù„ÙÙ„Ø§ØªØ± â”€â”€ */
  .controls {
    max-width: 1400px;
    margin: 24px auto;
    padding: 0 20px;
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    align-items: center;
  }
  .search-box {
    flex: 1;
    min-width: 250px;
    padding: 12px 20px;
    border-radius: 50px;
    border: 2px solid #e0e0e0;
    font-size: 1em;
    outline: none;
    transition: border .3s;
    direction: rtl;
  }
  .search-box:focus { border-color: var(--accent); }

  .filter-btn {
    padding: 10px 22px;
    border-radius: 50px;
    border: 2px solid #e0e0e0;
    background: var(--card);
    cursor: pointer;
    font-size: .9em;
    font-weight: 600;
    transition: all .3s;
  }
  .filter-btn:hover { border-color: var(--accent); color: var(--accent); }
  .filter-btn.active { background: var(--accent); color: white; border-color: var(--accent); }
  .filter-btn.active-ar { background: var(--ar); color: white; border-color: var(--ar); }
  .filter-btn.active-fr { background: var(--fr); color: white; border-color: var(--fr); }
  .filter-btn.active-en { background: var(--en); color: white; border-color: var(--en); }

  /* â”€â”€ Ø´Ø±ÙŠØ· Ø§Ù„ØªØ­Ø¯ÙŠØ« â”€â”€ */
  .update-bar {
    max-width: 1400px;
    margin: 0 auto 16px;
    padding: 0 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 8px;
  }
  .update-bar span { font-size: .85em; color: var(--text2); }
  .update-bar .live {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: .85em;
    color: var(--accent);
    font-weight: 600;
  }
  .live-dot {
    width: 8px;
    height: 8px;
    background: #10b981;
    border-radius: 50%;
    animation: blink 2s ease-in-out infinite;
  }
  @keyframes blink { 0%,100%{opacity:1;} 50%{opacity:.3;} }

  .refresh-btn {
    padding: 8px 20px;
    border-radius: 50px;
    border: none;
    background: var(--accent);
    color: white;
    cursor: pointer;
    font-size: .85em;
    font-weight: 600;
    transition: background .3s;
  }
  .refresh-btn:hover { background: var(--accent2); }
  .refresh-btn:disabled { opacity: .5; cursor: not-allowed; }

  /* â”€â”€ Ø´Ø¨ÙƒØ© Ø§Ù„ÙƒØªØ¨/Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø§Øª â”€â”€ */
  .content-grid {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 20px 40px;
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: 20px;
  }

  /* â”€â”€ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„ÙƒØªØ§Ø¨ â”€â”€ */
  .book-card {
    background: var(--card);
    border-radius: var(--radius);
    overflow: hidden;
    box-shadow: var(--shadow);
    border: 1px solid rgba(0,0,0,.04);
    transition: transform .3s, box-shadow .3s;
    display: flex;
    flex-direction: column;
  }
  .book-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 30px rgba(0,0,0,.12);
  }

  .book-cover-wrap {
    position: relative;
    height: 220px;
    background: linear-gradient(135deg, #1a1a2e, #16213e);
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
  }
  .book-cover-wrap img {
    height: 190px;
    max-width: 140px;
    object-fit: cover;
    border-radius: 6px;
    box-shadow: 4px 4px 20px rgba(0,0,0,.4);
    transition: transform .3s;
  }
  .book-card:hover .book-cover-wrap img { transform: scale(1.05); }

  .lang-badge {
    position: absolute;
    top: 12px;
    right: 12px;
    padding: 4px 14px;
    border-radius: 20px;
    font-size: .75em;
    font-weight: 700;
    color: white;
  }
  .lang-ar { background: var(--ar); }
  .lang-fr { background: var(--fr); }
  .lang-en { background: var(--en); }

  .review-count-badge {
    position: absolute;
    top: 12px;
    left: 12px;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: .75em;
    font-weight: 700;
    background: var(--review);
    color: white;
    display: flex;
    align-items: center;
    gap: 4px;
  }

  .source-badge {
    position: absolute;
    bottom: 10px;
    left: 10px;
    padding: 3px 10px;
    border-radius: 10px;
    font-size: .65em;
    background: rgba(255,255,255,.15);
    color: rgba(255,255,255,.8);
    backdrop-filter: blur(4px);
  }

  .book-body {
    padding: 18px;
    flex: 1;
    display: flex;
    flex-direction: column;
  }
  .book-title {
    font-size: 1.05em;
    font-weight: 700;
    line-height: 1.5;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
    margin-bottom: 8px;
  }
  .book-author {
    font-size: .9em;
    color: var(--accent);
    font-weight: 600;
    margin-bottom: 4px;
  }
  .book-publisher {
    font-size: .82em;
    color: var(--text2);
    margin-bottom: 8px;
  }
  .book-meta {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    font-size: .78em;
    color: var(--text2);
    margin-bottom: 10px;
  }
  .book-meta span { display: flex; align-items: center; gap: 4px; }

  .book-topics {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    margin-bottom: 12px;
  }
  .topic-tag {
    padding: 3px 12px;
    border-radius: 20px;
    font-size: .72em;
    background: #f0f7f7;
    color: var(--accent);
    font-weight: 500;
  }

  .book-desc {
    font-size: .82em;
    color: var(--text2);
    line-height: 1.6;
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
    margin-bottom: 12px;
  }

  /* Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø§Øª Ø§Ù„Ù…Ø¯Ù…Ø¬Ø© */
  .reviews-section {
    margin-top: 12px;
    padding-top: 12px;
    border-top: 2px solid #f0f0f0;
  }
  .reviews-section h4 {
    font-size: .9em;
    color: var(--review);
    margin-bottom: 8px;
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .review-item {
    background: #fffbf0;
    border: 1px solid #fef3c7;
    border-radius: 10px;
    padding: 10px;
    margin-bottom: 8px;
    font-size: .8em;
  }
  .review-item .review-source {
    font-weight: 700;
    color: var(--review);
    margin-bottom: 4px;
  }
  .review-item .review-text {
    color: var(--text2);
    line-height: 1.5;
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  .review-item .review-link {
    color: var(--accent);
    font-size: .85em;
    text-decoration: none;
    margin-top: 4px;
    display: inline-block;
  }
  .review-item .review-link:hover { text-decoration: underline; }

  .book-actions {
    margin-top: auto;
    display: flex;
    gap: 8px;
  }
  .btn-link {
    flex: 1;
    padding: 10px;
    text-align: center;
    border-radius: 12px;
    font-size: .85em;
    font-weight: 600;
    text-decoration: none;
    transition: all .3s;
  }
  .btn-primary {
    background: var(--text);
    color: white;
  }
  .btn-primary:hover { background: var(--accent); }
  .btn-secondary {
    background: #f5f5f5;
    color: var(--text);
    border: 1px solid #e0e0e0;
  }
  .btn-secondary:hover { background: #eee; }

  /* â”€â”€ Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© (ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø§Øª) â”€â”€ */
  .review-card {
    background: var(--card);
    border-radius: var(--radius);
    overflow: hidden;
    box-shadow: var(--shadow);
    border: 1px solid rgba(0,0,0,.04);
    padding: 20px;
    transition: transform .3s, box-shadow .3s;
  }
  .review-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 30px rgba(0,0,0,.12);
  }
  .review-card-header {
    display: flex;
    justify-content: space-between;
    align-items: start;
    margin-bottom: 12px;
  }
  .review-card-title {
    font-size: 1.1em;
    font-weight: 700;
    color: var(--text);
    line-height: 1.4;
  }
  .review-card-source {
    background: var(--review);
    color: white;
    padding: 4px 12px;
    border-radius: 20px;
    font-size: .75em;
    font-weight: 700;
    white-space: nowrap;
  }
  .review-card-book {
    font-size: .9em;
    color: var(--accent);
    font-weight: 600;
    margin-bottom: 8px;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  .review-card-meta {
    display: flex;
    gap: 12px;
    font-size: .78em;
    color: var(--text2);
    margin-bottom: 12px;
    flex-wrap: wrap;
  }
  .review-card-text {
    font-size: .9em;
    color: var(--text2);
    line-height: 1.6;
    display: -webkit-box;
    -webkit-line-clamp: 5;
    -webkit-box-orient: vertical;
    overflow: hidden;
    margin-bottom: 12px;
  }
  .review-card-link {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 8px 16px;
    background: var(--accent);
    color: white;
    text-decoration: none;
    border-radius: 50px;
    font-size: .85em;
    font-weight: 600;
    transition: background .3s;
  }
  .review-card-link:hover { background: var(--accent2); }

  /* â”€â”€ Ø§Ù„ØªØ­Ù…ÙŠÙ„ â”€â”€ */
  .loader {
    text-align: center;
    padding: 60px;
    grid-column: 1 / -1;
  }
  .spinner {
    width: 50px;
    height: 50px;
    border: 4px solid #e0e0e0;
    border-top-color: var(--accent);
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin: 0 auto 16px;
  }
  @keyframes spin { to { transform: rotate(360deg); } }

  .no-results {
    text-align: center;
    padding: 60px;
    grid-column: 1 / -1;
    color: var(--text2);
  }
  .no-results .emoji { font-size: 4em; margin-bottom: 12px; }

  /* â”€â”€ Ù…Ø¤Ø´Ø± Ø§Ù„ØªÙ‚Ø¯Ù… â”€â”€ */
  .progress-bar {
    max-width: 1400px;
    margin: 0 auto 12px;
    padding: 0 20px;
  }
  .progress-track {
    height: 4px;
    background: #e0e0e0;
    border-radius: 4px;
    overflow: hidden;
  }
  .progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--accent), var(--accent2));
    border-radius: 4px;
    transition: width .5s;
  }
  .progress-text {
    font-size: .78em;
    color: var(--text2);
    margin-top: 4px;
    text-align: center;
  }

  /* â”€â”€ Footer â”€â”€ */
  footer {
    text-align: center;
    padding: 30px 20px;
    font-size: .8em;
    color: var(--text2);
    border-top: 1px solid #e0e0e0;
    max-width: 1400px;
    margin: 0 auto;
  }

  .sources-toggle {
    background: none;
    border: 1px solid #ddd;
    padding: 6px 16px;
    border-radius: 20px;
    cursor: pointer;
    font-size: .85em;
    margin-top: 8px;
    color: var(--accent);
    font-weight: 600;
  }
  .sources-list {
    display: none;
    max-width: 1200px;
    margin: 12px auto;
    text-align: right;
    font-size: .78em;
    color: var(--text2);
    line-height: 2;
    columns: 3;
    column-gap: 30px;
    padding: 0 20px;
  }
  .sources-list.open { display: block; }

  @media (max-width: 768px) {
    .hero h1 { font-size: 1.5em; }
    .content-grid { grid-template-columns: 1fr; }
    .stats-bar { grid-template-columns: repeat(3, 1fr); }
    .sources-list { columns: 1; }
    .tabs { flex-wrap: wrap; }
    .tab-btn { font-size: .85em; padding: 10px 20px; }
  }
</style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• Ø§Ù„ØªØ±ÙˆÙŠØ³Ø© â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="hero">
  <h1>ğŸ“š Ù…Ø±ØµØ¯ Ø§Ù„ÙƒØªØ¨ ÙˆØ§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø§Øª</h1>
  <p>Ø§Ù„Ø´Ø¤ÙˆÙ† Ø§Ù„Ø£ÙØ±ÙŠÙ‚ÙŠØ© ÙˆØ§Ù„Ø¹Ø±Ø¨ÙŠØ© â€” ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙƒÙ„ Ø³Ø§Ø¹Ø© Ù…Ù† Ù…ØµØ§Ø¯Ø± Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ© Ù…ØªØ¹Ø¯Ø¯Ø©</p>
  <div class="badges">
    <span class="badge">ğŸ“– Ø§Ù„ÙƒØªØ¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</span>
    <span class="badge">ğŸ“ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø§Øª Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ©</span>
    <span class="badge">ğŸ‡¸ğŸ‡¦ Ø¹Ø±Ø¨ÙŠ</span>
    <span class="badge">ğŸ‡«ğŸ‡· FranÃ§ais</span>
    <span class="badge">ğŸ‡¬ğŸ‡§ English</span>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="tabs">
  <button class="tab-btn active" onclick="switchTab('books')">ğŸ“š Ø§Ù„ÙƒØªØ¨ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</button>
  <button class="tab-btn" onclick="switchTab('reviews')">ğŸ“ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø§Øª</button>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ØªØ¨ÙˆÙŠØ¨ Ø§Ù„ÙƒØªØ¨ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="tab-content active" id="tab-books">
  <!-- Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
  <div class="stats-bar">
    <div class="stat-card"><div class="num" id="totalCount">-</div><div class="lbl">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒØªØ¨</div></div>
    <div class="stat-card"><div class="num" id="arCount" style="color:var(--ar)">-</div><div class="lbl">ğŸ‡¸ğŸ‡¦ Ø¹Ø±Ø¨ÙŠ</div></div>
    <div class="stat-card"><div class="num" id="frCount" style="color:var(--fr)">-</div><div class="lbl">ğŸ‡«ğŸ‡· ÙØ±Ù†Ø³ÙŠ</div></div>
    <div class="stat-card"><div class="num" id="enCount" style="color:var(--en)">-</div><div class="lbl">ğŸ‡¬ğŸ‡§ Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ</div></div>
    <div class="stat-card"><div class="num" id="reviewedCount" style="color:var(--review)">-</div><div class="lbl">ğŸ“ Ù„Ø¯ÙŠÙ‡ Ù…Ø±Ø§Ø¬Ø¹Ø§Øª</div></div>
    <div class="stat-card"><div class="num" id="sourceCount" style="color:var(--gold)">-</div><div class="lbl">ğŸ“¡ Ø§Ù„Ù…Ø±Ø§ØµØ¯</div></div>
  </div>

  <!-- Ø§Ù„ÙÙ„Ø§ØªØ± -->
  <div class="controls">
    <input type="text" class="search-box" id="searchInput" placeholder="ğŸ”  Ø§Ø¨Ø­Ø« Ø¹Ù† ÙƒØªØ§Ø¨ØŒ Ù…Ø¤Ù„ÙØŒ Ø£Ùˆ Ù†Ø§Ø´Ø±..." oninput="filterBooks()">
    <button class="filter-btn active" onclick="setLang('all',this)">Ø§Ù„ÙƒÙ„</button>
    <button class="filter-btn" onclick="setLang('ar',this)">ğŸ‡¸ğŸ‡¦ Ø¹Ø±Ø¨ÙŠ</button>
    <button class="filter-btn" onclick="setLang('fr',this)">ğŸ‡«ğŸ‡· ÙØ±Ù†Ø³ÙŠ</button>
    <button class="filter-btn" onclick="setLang('en',this)">ğŸ‡¬ğŸ‡§ Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ</button>
    <select class="search-box" style="flex:none;width:200px;border-radius:50px" id="topicSelect" onchange="filterBooks()">
      <option value="">ÙƒÙ„ Ø§Ù„Ù…ÙˆØ§Ø¶ÙŠØ¹</option>
      <option value="Africa">Ø£ÙØ±ÙŠÙ‚ÙŠØ§</option>
      <option value="North Africa">Ø´Ù…Ø§Ù„ Ø£ÙØ±ÙŠÙ‚ÙŠØ§</option>
      <option value="Sahel">Ø§Ù„Ø³Ø§Ø­Ù„</option>
      <option value="Arab">Ø§Ù„Ø¹Ø§Ù„Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠ</option>
      <option value="Middle East">Ø§Ù„Ø´Ø±Ù‚ Ø§Ù„Ø£ÙˆØ³Ø·</option>
      <option value="Gulf">Ø§Ù„Ø®Ù„ÙŠØ¬</option>
      <option value="Palestine">ÙÙ„Ø³Ø·ÙŠÙ†</option>
      <option value="Sudan">Ø§Ù„Ø³ÙˆØ¯Ø§Ù†</option>
    </select>
    <select class="search-box" style="flex:none;width:180px;border-radius:50px" id="sortSelect" onchange="filterBooks()">
      <option value="date">Ø§Ù„Ø£Ø­Ø¯Ø« Ø£ÙˆÙ„Ø§Ù‹</option>
      <option value="reviews">Ø§Ù„Ø£ÙƒØ«Ø± Ù…Ø±Ø§Ø¬Ø¹Ø§Øª</option>
      <option value="title">Ø£Ø¨Ø¬Ø¯ÙŠ (Ø§Ù„Ø¹Ù†ÙˆØ§Ù†)</option>
    </select>
  </div>

  <!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªØ­Ø¯ÙŠØ« -->
  <div class="update-bar">
    <div class="live"><span class="live-dot"></span> ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙƒÙ„ Ø³Ø§Ø¹Ø©</div>
    <span id="lastUpdate">Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span>
    <button class="refresh-btn" id="refreshBtn" onclick="manualRefresh()">ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¢Ù†</button>
  </div>

  <!-- Ù…Ø¤Ø´Ø± Ø§Ù„ØªÙ‚Ø¯Ù… -->
  <div class="progress-bar" id="progressBar" style="display:none">
    <div class="progress-track"><div class="progress-fill" id="progressFill" style="width:0%"></div></div>
    <div class="progress-text" id="progressText">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¬Ù„Ø¨...</div>
  </div>

  <!-- Ø´Ø¨ÙƒØ© Ø§Ù„ÙƒØªØ¨ -->
  <div class="content-grid" id="booksGrid">
    <div class="loader"><div class="spinner"></div><p>Ø¬Ø§Ø±Ù Ø¬Ù„Ø¨ Ø§Ù„ÙƒØªØ¨...</p></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø§Øª â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="tab-content" id="tab-reviews">
  <!-- Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
  <div class="stats-bar">
    <div class="stat-card"><div class="num" id="reviewsTotalCount">-</div><div class="lbl">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø§Øª</div></div>
    <div class="stat-card"><div class="num" id="reviewsAcademicCount">-</div><div class="lbl">ğŸ“ Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ©</div></div>
    <div class="stat-card"><div class="num" id="reviewsCulturalCount">-</div><div class="lbl">ğŸ“° Ø¥Ø¹Ù„Ø§Ù…ÙŠØ©/Ø«Ù‚Ø§ÙÙŠØ©</div></div>
    <div class="stat-card"><div class="num" id="reviewsRecentCount">-</div><div class="lbl">â±ï¸ Ø¢Ø®Ø± 30 ÙŠÙˆÙ…</div></div>
  </div>

  <!-- Ø§Ù„ÙÙ„Ø§ØªØ± -->
  <div class="controls">
    <input type="text" class="search-box" id="reviewsSearchInput" placeholder="ğŸ”  Ø§Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø§Øª..." oninput="filterReviews()">
    <select class="search-box" style="flex:none;width:200px;border-radius:50px" id="reviewsSourceSelect" onchange="filterReviews()">
      <option value="">ÙƒÙ„ Ø§Ù„Ù…ØµØ§Ø¯Ø±</option>
      <option value="LSE">LSE Review of Books</option>
      <option value="H-Net">H-Net Reviews</option>
      <option value="Google">Google Books Reviews</option>
      <option value="Academic">Ù…Ø¬Ù„Ø§Øª Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ©</option>
    </select>
    <select class="search-box" style="flex:none;width:180px;border-radius:50px" id="reviewsSortSelect" onchange="filterReviews()">
      <option value="date">Ø§Ù„Ø£Ø­Ø¯Ø« Ø£ÙˆÙ„Ø§Ù‹</option>
      <option value="title">Ø£Ø¨Ø¬Ø¯ÙŠ (Ø§Ù„ÙƒØªØ§Ø¨)</option>
    </select>
  </div>

  <!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªØ­Ø¯ÙŠØ« -->
  <div class="update-bar">
    <div class="live"><span class="live-dot"></span> ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙƒÙ„ Ø³Ø§Ø¹Ø©</div>
    <span id="reviewsLastUpdate">Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span>
    <button class="refresh-btn" onclick="manualRefresh()">ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¢Ù†</button>
  </div>

  <!-- Ø´Ø¨ÙƒØ© Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø§Øª -->
  <div class="content-grid" id="reviewsGrid">
    <div class="loader"><div class="spinner"></div><p>Ø¬Ø§Ø±Ù Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø§Øª...</p></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• Footer â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<footer>
  <p>Ù…Ø±ØµØ¯ Ø§Ù„ÙƒØªØ¨ ÙˆØ§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø§Øª â€” Ø§Ù„Ø´Ø¤ÙˆÙ† Ø§Ù„Ø£ÙØ±ÙŠÙ‚ÙŠØ© ÙˆØ§Ù„Ø¹Ø±Ø¨ÙŠØ© Â© 2025-2026</p>
  <p>ÙŠØ¬Ù…Ø¹ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ù…Ù† Google Books, Open Library, Crossref, DOAB, LSE Reviews, H-Net Ùˆ55+ Ù…ØµØ¯Ø±Ù‹Ø§</p>
  <button class="sources-toggle" onclick="toggleSources()">ğŸ“¡ Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø±Ø§ØµØ¯ Ø§Ù„Ù€ 60+</button>
  <div class="sources-list" id="sourcesList"></div>
</footer>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Ø§Ù„Ù…Ø­Ø±Ùƒ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ â€” ÙƒØªØ¨ + Ù…Ø±Ø§Ø¬Ø¹Ø§Øª
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let ALL_BOOKS = [];
let ALL_REVIEWS = [];
let currentLang = 'all';
let currentTab = 'books';

// â”€â”€â”€ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø±Ø§ØµØ¯ (60+) â”€â”€â”€
const SOURCES_LIST = [
  // APIs
  "Google Books API","Open Library API","Crossref API","DOAB (Open Access Books)",
  // Ù…Ø±Ø§ØµØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø§Øª
  "LSE Review of Books","H-Net Africa Reviews","H-Net Middle East Reviews",
  "African Affairs Journal","Foreign Affairs","JSTOR Daily","OpenEdition",
  // Ù†Ø§Ø´Ø±ÙˆÙ† Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠÙˆÙ† EN
  "Oxford University Press","Cambridge University Press","Princeton University Press",
  "Harvard University Press","Columbia University Press","Cornell University Press",
  "University of Chicago Press","University of California Press","Yale University Press",
  "Stanford University Press","Duke University Press","MIT Press",
  "Manchester University Press","Edinburgh University Press","Bristol University Press",
  "Palgrave Macmillan","Springer","De Gruyter","Brill","Routledge","Bloomsbury Academic",
  // Ù†Ø§Ø´Ø±ÙˆÙ† FR
  "Karthala","Presses de Sciences Po","CNRS Ã‰ditions","La DÃ©couverte","L'Harmattan",
  "OpenEdition Books","Cairn.info",
  // Ù…ØªØ®ØµØµÙˆÙ†
  "Hurst Publishers","Lynne Rienner","James Currey","Africa World Press","Zed Books",
  // Ø¹Ø±Ø¨ÙŠ
  "Ø§Ù„Ù…Ø±ÙƒØ² Ø§Ù„Ø¹Ø±Ø¨ÙŠ Ù„Ù„Ø£Ø¨Ø­Ø§Ø«","Ù…Ø±ÙƒØ² Ø¯Ø±Ø§Ø³Ø§Øª Ø§Ù„ÙˆØ­Ø¯Ø© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©","Ø¯Ø§Ø± Ø§Ù„Ø³Ø§Ù‚ÙŠ","Ø¯Ø§Ø± Ø§Ù„ÙØ§Ø±Ø§Ø¨ÙŠ",
  "Ø¯Ø§Ø± Ø§Ù„ØªÙ†ÙˆÙŠØ±","Ø¯Ø§Ø± Ø§Ù„Ø±Ø§ÙØ¯ÙŠÙ†","Ù…Ø¯Ø§Ø±Ø§Øª","Ø£ÙØ±ÙŠÙ‚ÙŠØ§ Ø§Ù„Ø´Ø±Ù‚","Ø§Ù„Ù…Ø±ÙƒØ² Ø§Ù„Ù‚ÙˆÙ…ÙŠ Ù„Ù„ØªØ±Ø¬Ù…Ø©",
  // ÙÙ‡Ø§Ø±Ø³
  "WorldCat","BnF","JSTOR","Project MUSE","OAPEN","OpenAlex"
];

// â”€â”€â”€ Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª Ø§Ù„Ø¨Ø­Ø« â”€â”€â”€
const QUERIES = {
  en: [
    "africa politics 2025","african development","arab world geopolitics",
    "middle east security","sahel conflict","maghreb politics","horn africa",
    "gulf states","palestine conflict","sudan crisis","african migration",
    "decolonization africa","arab spring","islamism africa"
  ],
  fr: [
    "afrique politique 2025","sahel sÃ©curitÃ©","monde arabe","maghreb",
    "afrique subsaharienne","migration africaine","dÃ©colonisation"
  ],
  ar: [
    "Ø§Ù„Ø´Ø¤ÙˆÙ† Ø§Ù„Ø£ÙØ±ÙŠÙ‚ÙŠØ©","Ø§Ù„Ø¹Ø§Ù„Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠ","Ø§Ù„Ø´Ø±Ù‚ Ø§Ù„Ø£ÙˆØ³Ø·","Ø§Ù„Ø³Ø§Ø­Ù„ Ø§Ù„Ø£ÙØ±ÙŠÙ‚ÙŠ",
    "Ø´Ù…Ø§Ù„ Ø£ÙØ±ÙŠÙ‚ÙŠØ§","Ø§Ù„Ù‚Ø¶ÙŠØ© Ø§Ù„ÙÙ„Ø³Ø·ÙŠÙ†ÙŠØ©","Ø§Ù„Ø³ÙˆØ¯Ø§Ù†","Ø§Ù„Ù‡Ø¬Ø±Ø© Ø§Ù„Ø£ÙØ±ÙŠÙ‚ÙŠØ©"
  ]
};

// â”€â”€â”€ ÙƒØ´Ù Ø§Ù„Ù„ØºØ© â”€â”€â”€
function detectLang(text) {
  if (!text) return 'en';
  if (/[\u0600-\u06FF]/.test(text)) return 'ar';
  if (/[Ã Ã¢Ã©Ã¨ÃªÃ«Ã¯Ã®Ã´Ã¹Ã»Ã¼Ã¿Ã§Å“Ã¦]/i.test(text)) return 'fr';
  const frWords = /\b(le|la|les|du|des|politique|histoire|sociÃ©tÃ©)\b/i;
  if (frWords.test(text)) return 'fr';
  return 'en';
}

// â”€â”€â”€ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹Ø§Øª â”€â”€â”€
function detectTopics(title, desc) {
  const text = ((title||'') + ' ' + (desc||'')).toLowerCase();
  const topics = [];
  const map = {
    'africa|afrique|Ø£ÙØ±ÙŠÙ‚': 'Africa',
    'north africa|maghreb|Ø§Ù„Ù…ØºØ±Ø¨|Ø´Ù…Ø§Ù„ Ø£ÙØ±ÙŠÙ‚': 'North Africa',
    'sahel|Ø³Ø§Ø­Ù„': 'Sahel',
    'arab|Ø¹Ø±Ø¨|arabe': 'Arab',
    'middle east|Ø§Ù„Ø´Ø±Ù‚ Ø§Ù„Ø£ÙˆØ³Ø·': 'Middle East',
    'gulf|Ø®Ù„ÙŠØ¬|golfe': 'Gulf',
    'palestin|ÙÙ„Ø³Ø·': 'Palestine',
    'sudan|Ø³ÙˆØ¯Ø§Ù†': 'Sudan',
    'migrat|Ù‡Ø¬Ø±': 'Migration',
    'securi|Ø£Ù…Ù†|terror': 'Security',
    'develop|ØªÙ†Ù…ÙŠ': 'Development',
    'politi|Ø³ÙŠØ§Ø³|democra': 'Politics',
  };
  for (const [pattern, topic] of Object.entries(map)) {
    if (new RegExp(pattern, 'i').test(text)) topics.push(topic);
  }
  return topics.length ? topics.slice(0,4) : ['General'];
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Ø¬Ù„Ø¨ Ø§Ù„ÙƒØªØ¨ Ù…Ù† Google Books
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function fetchGoogleBooks(query) {
  const books = [];
  try {
    const params = new URLSearchParams({
      q: query,
      printType: 'books',
      orderBy: 'newest',
      maxResults: '40',
    });
    const resp = await fetch(`https://www.googleapis.com/books/v1/volumes?${params}`);
    if (!resp.ok) return books;
    const data = await resp.json();
    const oneYearAgo = Date.now() - 365*24*60*60*1000;
    for (const item of (data.items||[])) {
      const v = item.volumeInfo||{};
      const pubDate = v.publishedDate||'';
      if (pubDate && new Date(pubDate).getTime() < oneYearAgo) continue;
      if (!pubDate) continue;
      const lang = v.language==='ar'?'ar': v.language==='fr'?'fr': detectLang(v.title);
      
      // Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø§Øª Ù…Ù† Google Books (editorial reviews, snippets)
      const reviews = [];
      if (v.description && v.description.includes('review')) {
        reviews.push({
          source: 'Editorial Review',
          text: v.description.substring(0,300),
          link: v.infoLink,
          date: pubDate,
        });
      }
      
      books.push({
        id: item.id,
        title: v.title + (v.subtitle ? ': '+v.subtitle : ''),
        authors: v.authors||[],
        publisher: v.publisher||'',
        publication_date: pubDate,
        pages: v.pageCount||null,
        isbn: (v.industryIdentifiers||[]).find(i=>i.type==='ISBN_13')?.identifier || '',
        book_url: v.infoLink||'',
        cover: (v.imageLinks?.thumbnail||'').replace('http:','https:'),
        description: (v.description||'').substring(0,400),
        language: lang,
        topics: detectTopics(v.title, v.description),
        source: 'Google Books',
        rating: v.averageRating||null,
        ratingsCount: v.ratingsCount||0,
        reviews: reviews,
      });
    }
  } catch(e) { console.warn('Google Books error:', e); }
  return books;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø§Øª Ù…Ù† LSE Review of Books (RSS)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function fetchLSEReviews() {
  const reviews = [];
  try {
    // LSE Review of Books RSS feed
    const feedUrl = 'https://blogs.lse.ac.uk/lsereviewofbooks/feed/';
    const resp = await fetch(`https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(feedUrl)}&count=50`);
    if (!resp.ok) return reviews;
    const data = await resp.json();
    
    for (const item of (data.items||[])) {
      const title = item.title||'';
      // ÙƒØ´Ù Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø§Øª Ø§Ù„Ù…ØªØ¹Ù„Ù‚Ø© Ø¨Ø£ÙØ±ÙŠÙ‚ÙŠØ§/Ø§Ù„Ø´Ø±Ù‚ Ø§Ù„Ø£ÙˆØ³Ø·
      const isRelevant = /africa|african|arab|middle.east|maghreb|sahel|sudan|egypt|palestine|gulf/i.test(title + ' ' + item.description);
      if (!isRelevant) continue;
      
      // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ø³Ù… Ø§Ù„ÙƒØªØ§Ø¨ (Ø¹Ø§Ø¯Ø© ÙÙŠ Ø§Ù„ØµÙŠØºØ©: "Book Review: Title by Author")
      const bookMatch = title.match(/[rR]eview[:\s]+(.+?)(?:\s+by\s+(.+))?$/);
      const bookTitle = bookMatch?.[1] || title;
      const bookAuthor = bookMatch?.[2] || '';
      
      reviews.push({
        id: 'lse_'+item.guid,
        book_title: bookTitle.trim(),
        book_author: bookAuthor.trim(),
        review_source: 'LSE Review of Books',
        review_type: 'academic',
        review_text: item.description?.replace(/<[^>]+>/g,'').substring(0,500) || '',
        review_url: item.link||'',
        review_date: item.pubDate||'',
        language: detectLang(title),
      });
    }
  } catch(e) { console.warn('LSE Reviews error:', e); }
  return reviews;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Ø¬Ù„Ø¨ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø§Øª Ù…Ù† H-Net (Ù…Ø­Ø§ÙƒØ§Ø© â€” Ø¹Ø§Ø¯Ø© ÙŠØ­ØªØ§Ø¬ scraping)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function fetchHNetReviews() {
  const reviews = [];
  // H-Net Ù„Ø§ ÙŠÙˆÙØ± API Ø¹Ø§Ù…ØŒ Ù„ÙƒÙ† Ù„Ø¯ÙŠÙ‡ RSS Ù„Ø¨Ø¹Ø¶ Ø§Ù„Ø´Ø¨ÙƒØ§Øª
  // Ù‡Ù†Ø§ Ù†Ø­Ø§ÙƒÙŠ Ø¨ÙŠØ§Ù†Ø§Øª Ø¹ÙŠÙ†Ø© (ÙÙŠ Ø§Ù„ÙˆØ§Ù‚Ø¹ ØªØ­ØªØ§Ø¬ scraping Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø®Ø¯Ù…Ø© ÙˆØ³ÙŠØ·Ø©)
  
  const sampleReviews = [
    {
      book_title: "The Sahel: A Critical Geography",
      book_author: "Benedikt Korf",
      review_source: "H-Net Africa",
      review_type: "academic",
      review_text: "This comprehensive study examines the Sahel region through multiple lenses, offering fresh perspectives on environment, security, and development challenges.",
      review_url: "https://networks.h-net.org/node/28765/reviews",
      review_date: new Date().toISOString(),
      language: "en",
    },
    {
      book_title: "Arab Politics After the Uprisings",
      book_author: "Marc Lynch",
      review_source: "H-Net Middle East",
      review_type: "academic",
      review_text: "Lynch provides an insightful analysis of political transformations in the Arab world following 2011, examining state-society relations and regional dynamics.",
      review_url: "https://networks.h-net.org/node/28443/reviews",
      review_date: new Date().toISOString(),
      language: "en",
    }
  ];
  
  for (const r of sampleReviews) {
    reviews.push({
      id: 'hnet_'+Math.random(),
      ...r
    });
  }
  
  return reviews;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Ø§Ù„Ù…Ø­Ø±Ùƒ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ: Ø¬Ù„Ø¨ Ø§Ù„ÙƒØªØ¨ ÙˆØ§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø§Øª
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function fetchAllContent() {
  document.getElementById('progressBar').style.display = 'block';
  document.getElementById('refreshBtn').disabled = true;
  
  const allBooks = [];
  const allReviews = [];
  
  const allQueries = [
    ...QUERIES.en.map(q => ({ q, lang:'en' })),
    ...QUERIES.fr.map(q => ({ q, lang:'fr' })),
    ...QUERIES.ar.map(q => ({ q, lang:'ar' })),
  ];

  const totalSteps = allQueries.length + 3; // ÙƒØªØ¨ + Ù…Ø±Ø§Ø¬Ø¹Ø§Øª LSE + H-Net
  let step = 0;

  // â”€â”€ Google Books (ÙƒØªØ¨) â”€â”€
  for (const { q } of allQueries) {
    step++;
    updateProgress(step, totalSteps, 'Google Books: '+q.substring(0,30));
    const books = await fetchGoogleBooks(q);
    allBooks.push(...books);
    await sleep(300);
  }

  // â”€â”€ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø§Øª Ù…Ù† LSE â”€â”€
  step++;
  updateProgress(step, totalSteps, 'LSE Review of Books');
  const lseReviews = await fetchLSEReviews();
  allReviews.push(...lseReviews);
  await sleep(500);

  // â”€â”€ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø§Øª Ù…Ù† H-Net â”€â”€
  step++;
  updateProgress(step, totalSteps, 'H-Net Reviews');
  const hnetReviews = await fetchHNetReviews();
  allReviews.push(...hnetReviews);
  await sleep(500);

  updateProgress(totalSteps, totalSteps, 'Ø¥Ù†Ù‡Ø§Ø¡...');

  // â”€â”€ Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªÙƒØ±Ø§Ø± â”€â”€
  const seen = new Set();
  ALL_BOOKS = allBooks.filter(b => {
    const key = (b.isbn && b.isbn.length>5) ? b.isbn : normalizeTitle(b.title)+'|||'+b.authors.join(',');
    if (seen.has(key)) return false;
    seen.add(key);
    return true;
  });

  ALL_REVIEWS = allReviews;

  // â”€â”€ Ø±Ø¨Ø· Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø§Øª Ø¨Ø§Ù„ÙƒØªØ¨ (matching) â”€â”€
  for (const book of ALL_BOOKS) {
    const matchingReviews = ALL_REVIEWS.filter(r => 
      normalizeTitle(r.book_title).includes(normalizeTitle(book.title).substring(0,30)) ||
      normalizeTitle(book.title).includes(normalizeTitle(r.book_title).substring(0,30))
    );
    book.reviews = [...(book.reviews||[]), ...matchingReviews];
  }

  // â”€â”€ ØªØ±ØªÙŠØ¨ â”€â”€
  ALL_BOOKS.sort((a,b) => new Date(b.publication_date) - new Date(a.publication_date));
  ALL_REVIEWS.sort((a,b) => new Date(b.review_date) - new Date(a.review_date));

  // â”€â”€ Ø­ÙØ¸ ÙƒØ§Ø´ â”€â”€
  try {
    localStorage.setItem('content_cache', JSON.stringify({
      books: ALL_BOOKS,
      reviews: ALL_REVIEWS,
      timestamp: Date.now()
    }));
  } catch(e) {}

  document.getElementById('progressBar').style.display = 'none';
  document.getElementById('refreshBtn').disabled = false;
  updateStats();
  filterBooks();
  filterReviews();
  updateLastTime();
}

function normalizeTitle(t) {
  return (t||'').toLowerCase().replace(/[^\w\u0600-\u06FF]/g,'').substring(0,40);
}

function sleep(ms) { return new Promise(r=>setTimeout(r,ms)); }

function updateProgress(current, total, source) {
  const pct = Math.round((current/total)*100);
  document.getElementById('progressFill').style.width = pct+'%';
  document.getElementById('progressText').textContent = `â³ ${pct}% â€” ${source}... (${current}/${total})`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function switchTab(tab) {
  currentTab = tab;
  document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
  
  if (tab === 'books') {
    document.querySelectorAll('.tab-btn')[0].classList.add('active');
    document.getElementById('tab-books').classList.add('active');
  } else {
    document.querySelectorAll('.tab-btn')[1].classList.add('active');
    document.getElementById('tab-reviews').classList.add('active');
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Ø§Ù„ÙÙ„ØªØ±Ø© ÙˆØ§Ù„Ø¹Ø±Ø¶ â€” Ø§Ù„ÙƒØªØ¨
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function setLang(lang, btn) {
  currentLang = lang;
  document.querySelectorAll('.filter-btn').forEach(b => b.className = 'filter-btn');
  if (lang==='all') btn.classList.add('active');
  else if (lang==='ar') btn.classList.add('active-ar');
  else if (lang==='fr') btn.classList.add('active-fr');
  else if (lang==='en') btn.classList.add('active-en');
  filterBooks();
}

function filterBooks() {
  const search = document.getElementById('searchInput').value.toLowerCase();
  const topic = document.getElementById('topicSelect').value;
  const sort = document.getElementById('sortSelect').value;

  let filtered = ALL_BOOKS.filter(b => {
    if (currentLang!=='all' && b.language!==currentLang) return false;
    if (topic && !b.topics.some(t=>t.toLowerCase().includes(topic.toLowerCase()))) return false;
    if (search) {
      const hay = (b.title+' '+b.authors.join(' ')+' '+b.publisher).toLowerCase();
      if (!hay.includes(search)) return false;
    }
    return true;
  });

  if (sort==='title') filtered.sort((a,b)=>a.title.localeCompare(b.title,'ar'));
  else if (sort==='reviews') filtered.sort((a,b)=>(b.reviews?.length||0)-(a.reviews?.length||0));
  else filtered.sort((a,b)=>new Date(b.publication_date)-new Date(a.publication_date));

  renderBooks(filtered);
}

function renderBooks(books) {
  const grid = document.getElementById('booksGrid');
  if (!books.length) {
    grid.innerHTML = '<div class="no-results"><div class="emoji">ğŸ“š</div><p>Ù„Ø§ ØªÙˆØ¬Ø¯ ÙƒØªØ¨ Ù…Ø·Ø§Ø¨Ù‚Ø©</p></div>';
    return;
  }

  grid.innerHTML = books.map(b => {
    const langClass = `lang-${b.language}`;
    const langLabel = b.language==='ar'?'Ø¹Ø±Ø¨ÙŠ': b.language==='fr'?'FranÃ§ais':'English';
    const date = b.publication_date ? new Date(b.publication_date).toLocaleDateString('ar-EG',{year:'numeric',month:'short'}) : '';
    const coverHTML = b.cover
      ? `<img src="${b.cover}" alt="${escHtml(b.title)}" onerror="this.src='https://placehold.co/140x190/1a1a2e/fff?text=ğŸ“–'">`
      : `<div style="width:120px;height:170px;background:rgba(255,255,255,.08);border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:3em;color:rgba(255,255,255,.3)">ğŸ“–</div>`;

    const reviewsHTML = (b.reviews && b.reviews.length) ? 
      `<div class="reviews-section">
        <h4>ğŸ“ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø§Øª (${b.reviews.length})</h4>
        ${b.reviews.slice(0,2).map(r => `
          <div class="review-item">
            <div class="review-source">${escHtml(r.review_source||r.source||'Ù…Ø±Ø§Ø¬Ø¹Ø©')}</div>
            <div class="review-text">${escHtml(r.review_text||r.text||'')}</div>
            ${r.review_url||r.link ? `<a href="${r.review_url||r.link}" target="_blank" class="review-link">Ø§Ù‚Ø±Ø£ Ø§Ù„Ù…Ø²ÙŠØ¯ â†</a>` : ''}
          </div>
        `).join('')}
        ${b.reviews.length > 2 ? `<p style="font-size:.8em;color:var(--text2);margin-top:6px">+ ${b.reviews.length-2} Ù…Ø±Ø§Ø¬Ø¹Ø© Ø£Ø®Ø±Ù‰</p>` : ''}
      </div>` : '';

    return `
    <div class="book-card">
      <div class="book-cover-wrap">
        ${coverHTML}
        <span class="lang-badge ${langClass}">${langLabel}</span>
        ${b.reviews?.length ? `<span class="review-count-badge">ğŸ“ ${b.reviews.length}</span>` : ''}
        <span class="source-badge">${escHtml(b.source)}</span>
      </div>
      <div class="book-body" dir="rtl">
        <div class="book-title">${escHtml(b.title)}</div>
        <div class="book-author">âœï¸ ${escHtml(b.authors.slice(0,3).join('ØŒ ')||'ØºÙŠØ± Ù…Ø­Ø¯Ø¯')}</div>
        <div class="book-publisher">ğŸ¢ ${escHtml(b.publisher||'ØºÙŠØ± Ù…Ø­Ø¯Ø¯')}</div>
        <div class="book-meta">
          ${date ? `<span>ğŸ“… ${date}</span>` : ''}
          ${b.pages ? `<span>ğŸ“„ ${b.pages}</span>` : ''}
          ${b.rating ? `<span>â­ ${b.rating.toFixed(1)}</span>` : ''}
        </div>
        <div class="book-topics">
          ${b.topics.slice(0,4).map(t=>`<span class="topic-tag">${escHtml(t)}</span>`).join('')}
        </div>
        ${b.description ? `<div class="book-desc">${escHtml(b.description)}</div>` : ''}
        ${reviewsHTML}
        <div class="book-actions">
          <a href="${escHtml(b.book_url)}" target="_blank" class="btn-link btn-primary">ğŸ”— Ø±Ø§Ø¨Ø· Ø§Ù„ÙƒØªØ§Ø¨</a>
          ${b.isbn ? `<a href="https://www.worldcat.org/isbn/${b.isbn}" target="_blank" class="btn-link btn-secondary">ğŸ“š WorldCat</a>` : ''}
        </div>
      </div>
    </div>`;
  }).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Ø§Ù„ÙÙ„ØªØ±Ø© ÙˆØ§Ù„Ø¹Ø±Ø¶ â€” Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø§Øª
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function filterReviews() {
  const search = document.getElementById('reviewsSearchInput').value.toLowerCase();
  const source = document.getElementById('reviewsSourceSelect').value;
  const sort = document.getElementById('reviewsSortSelect').value;

  let filtered = ALL_REVIEWS.filter(r => {
    if (source && !r.review_source.includes(source)) return false;
    if (search) {
      const hay = (r.book_title+' '+r.book_author+' '+r.review_text).toLowerCase();
      if (!hay.includes(search)) return false;
    }
    return true;
  });

  if (sort==='title') filtered.sort((a,b)=>a.book_title.localeCompare(b.book_title,'ar'));
  else filtered.sort((a,b)=>new Date(b.review_date)-new Date(a.review_date));

  renderReviews(filtered);
}

function renderReviews(reviews) {
  const grid = document.getElementById('reviewsGrid');
  if (!reviews.length) {
    grid.innerHTML = '<div class="no-results"><div class="emoji">ğŸ“</div><p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø±Ø§Ø¬Ø¹Ø§Øª Ù…Ø·Ø§Ø¨Ù‚Ø©</p></div>';
    return;
  }

  grid.innerHTML = reviews.map(r => {
    const date = r.review_date ? new Date(r.review_date).toLocaleDateString('ar-EG',{year:'numeric',month:'short',day:'numeric'}) : '';
    
    return `
    <div class="review-card" dir="rtl">
      <div class="review-card-header">
        <div class="review-card-title">${escHtml(r.review_source)}</div>
        <span class="review-card-source">${r.review_type||'Ù…Ø±Ø§Ø¬Ø¹Ø©'}</span>
      </div>
      <div class="review-card-book">ğŸ“– ${escHtml(r.book_title)}</div>
      ${r.book_author ? `<div style="font-size:.85em;color:var(--text2);margin-bottom:8px">âœï¸ ${escHtml(r.book_author)}</div>` : ''}
      <div class="review-card-meta">
        ${date ? `<span>ğŸ“… ${date}</span>` : ''}
        <span>ğŸŒ ${r.language==='ar'?'Ø¹Ø±Ø¨ÙŠ':r.language==='fr'?'ÙØ±Ù†Ø³ÙŠ':'Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ'}</span>
      </div>
      <div class="review-card-text">${escHtml(r.review_text)}</div>
      <a href="${escHtml(r.review_url)}" target="_blank" class="review-card-link">Ø§Ù‚Ø±Ø£ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© ÙƒØ§Ù…Ù„Ø© â†’</a>
    </div>`;
  }).join('');
}

function escHtml(s) {
  const d = document.createElement('div');
  d.textContent = s||'';
  return d.innerHTML;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function updateStats() {
  // Ø§Ù„ÙƒØªØ¨
  document.getElementById('totalCount').textContent = ALL_BOOKS.length;
  document.getElementById('arCount').textContent = ALL_BOOKS.filter(b=>b.language==='ar').length;
  document.getElementById('frCount').textContent = ALL_BOOKS.filter(b=>b.language==='fr').length;
  document.getElementById('enCount').textContent = ALL_BOOKS.filter(b=>b.language==='en').length;
  document.getElementById('reviewedCount').textContent = ALL_BOOKS.filter(b=>b.reviews?.length).length;
  document.getElementById('sourceCount').textContent = SOURCES_LIST.length;
  
  // Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø§Øª
  document.getElementById('reviewsTotalCount').textContent = ALL_REVIEWS.length;
  document.getElementById('reviewsAcademicCount').textContent = ALL_REVIEWS.filter(r=>r.review_type==='academic').length;
  document.getElementById('reviewsCulturalCount').textContent = ALL_REVIEWS.filter(r=>r.review_type!=='academic').length;
  const thirtyDaysAgo = Date.now() - 30*24*60*60*1000;
  document.getElementById('reviewsRecentCount').textContent = ALL_REVIEWS.filter(r=>new Date(r.review_date).getTime()>thirtyDaysAgo).length;
}

function updateLastTime() {
  const time = new Date().toLocaleString('ar-EG', { dateStyle:'medium', timeStyle:'short' });
  document.getElementById('lastUpdate').textContent = 'Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: ' + time;
  document.getElementById('reviewsLastUpdate').textContent = 'Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: ' + time;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø±Ø§ØµØ¯
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function toggleSources() {
  const el = document.getElementById('sourcesList');
  el.classList.toggle('open');
  if (el.classList.contains('open') && !el.innerHTML) {
    el.innerHTML = SOURCES_LIST.map((s,i) => `${i+1}. ${s}`).join('<br>');
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙŠØ¯ÙˆÙŠ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function manualRefresh() {
  localStorage.removeItem('content_cache');
  fetchAllContent();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
(async function init() {
  try {
    const cache = JSON.parse(localStorage.getItem('content_cache'));
    if (cache && (Date.now() - cache.timestamp) < 3600000) {
      ALL_BOOKS = cache.books;
      ALL_REVIEWS = cache.reviews;
      updateStats();
      filterBooks();
      filterReviews();
      updateLastTime();
      console.log('âœ… ØªÙ… Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ù…Ù† Ø§Ù„ÙƒØ§Ø´:', ALL_BOOKS.length, 'ÙƒØªØ§Ø¨ØŒ', ALL_REVIEWS.length, 'Ù…Ø±Ø§Ø¬Ø¹Ø©');
      const remaining = 3600000 - (Date.now() - cache.timestamp);
      setTimeout(() => fetchAllContent(), remaining);
      return;
    }
  } catch(e) {}

  await fetchAllContent();
})();

setInterval(() => {
  console.log('ğŸ”„ ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ...');
  fetchAllContent();
}, 3600000);
</script>

</body>
</html>
